## 组件的实现原理

### 一、 异步组件要解决的问题

1. 允许用户指定加载出错时要渲染的组件；
2. 允许用户指定 Loading 组件，以及展示该组件的延迟时间；
3. 允许用户设置加载组件的超时时长；
4. 组件加载失败时，为用户提供重试的能力。

### 二、异步组件的实现原理

#### 1. 封装 defineAsyncComponent 函数

- `defineAsyncComponent` 函数本质上是一个高阶组件，它的返回值是一个包装组件；
- 包装组件会根据加载器的状态来决定渲染什么内容。如果加载器成功地加载了组件，则渲染被加载的组件，否则会渲染一个占位内容；
- 通常占位内容是一个注释节点。组件没有被加载成功时，页面中会渲染一个注释节点来占位。但这里我们使用了一个空文本节点来占位。

#### 2. 超时与 Error 组件

`defineAsyncComponent` 需要接收一个配置对象作为参数：

- loader: 指定异步组件的加载器
- timeout: 单位 ms，指定超时时长
- errorComponent: 指定一个 Error 组件，当错误发生时会渲染它

#### 3. 延迟与 Loading 组件

配置项对象添加两个参数：

- delay: 用于指定延迟展示 Loading 组件的时长
- loadingComponent: 用于配置 Loading 组件

#### 4. 重试机制

配置项对象添加一个参数：

- onError: 包含三个参数，retry、fail、retries
